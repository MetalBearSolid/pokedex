<!DOCTYPE html>

<html>

<head>
  <meta name="format-detection" content="telephone=no" />
  <meta name="msapplication-tap-highlight" content="no" />
  <meta name="viewport" content="initial-scale=1, width=device-width, viewport-fit=cover" />

  <link rel="stylesheet" type="text/css" href="css/index.css">
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" type="text/css" href="https://unpkg.com/onsenui/css/onsenui.css">
  <link rel="stylesheet" type="text/css" href="https://unpkg.com/onsenui/css/onsen-css-components.min.css">
  <script src="https://unpkg.com/onsenui/js/onsenui.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>  
    <!-- <script src="./lib/onsenui/js/onsenui.min.js"></script> -->

  <!-- <link rel="stylesheet" type="text/css" href="./css/style.css" /> -->
  <title>Pokemon world!</title>
</head>

<body>

    <ons-navigator id="myNavigator" page="main-temp"></ons-navigator>
            
    <!-- ******************** main-template ******************** -->

    <template id="main-temp">
      <ons-page id="main-page">      
         <ons-toolbar style="background-color: red;">
          <div class="center" style="color: #fff;">Pokedex</div>
        </ons-toolbar>
      </ons-page>
   </template>

  <!-- ******************** list template ******************** -->
  
  <ons-page id="list-page">
    <div class="content content-container">
      <h2>Pokedex</h2>
      <ons-list id="list-item"></ons-list>
    </div>
  </ons-page>

   <!-- ******************* single pokemon template ******************* -->

    <template id="single-pokemon">
      <ons-page id="single-pokemon-page" style="padding-top: 30px;">
        <ons-toolbar style="background-color: #b8dbd9;">
          <div class="left">
            <ons-back-button>Back</ons-back-button>
          </div>
        </ons-toolbar>
        <ons-card> 
         
          <div class="section-headers"> <h3>Image Overview</h3> </div>
          <div id="imageList">
            <p>Hello world</p>
          </div>
      
          <ons-list id="description"></ons-list>
         
          </ons-card>
        </ons-page>
      </template>

  <!-- ******************** spinner modal ******************** -->

  <ons-modal id="spinner-modal">
    <div style="margin: auto;">
      <ons-icon icon="md-spinner" size="100px" spin></ons-icon>
    </div>
  </ons-modal>

  <script type="text/javascript" src="cordova.js"></script>
  <script>

 ons.ready(function() {

  var spinnerModal = document.querySelector('#spinner-modal');
  spinnerModal.show();

  const promises = [];
  for (let i = 1; i <= 151; i++) {
    const url = `https://pokeapi.co/api/v2/pokemon/${i}`;
    promises.push(fetch(url).then(res => res.json()));
  }
  Promise.all(promises).then(results => {
      const pokemon = results.map(data => ({
        name: data.name,
        id: data.id,
        image: data.sprites["front_default"],
        type: data.types.map(type => type.type.name).join(", "),
        ability: data.abilities.map(ability => ability.ability.name).join(','),
        moves: data.moves.map(move => move.move.name).slice(0, 10).join(', ')
      }));
      sendData(pokemon);
    })
    .catch((reason) => {
      if (reason === -999) {
        console.error("Had previously handled error");
      } else {
        console.error(`Trouble with promiseGetWord(): ${reason}`);
      }
    })
    .finally((info) => spinnerModal.hide());

  function sendData(jsonData) {
    var itemsList = document.getElementById('list-item'); // this is no longer null since this is no longer part of template.
    for (let i = 0; i < jsonData.length; i++) {

      itemsList.appendChild(
        ons.createElement(
          '<ons-list>' + '<ons-list-header>' + jsonData[i].name + '</ons-list-header>' + '<ons-list-item>' + '<div class="left"><img class="pokes" src="https://pokeres.bastionbot.org/images/pokemon/' + jsonData[i].id + '.png' + '"/>' +'</div>' + '<div class="center">' + 'type : ' + jsonData[i].type + '</div>' + '<div class="right"><ons-button onclick="pushOverView(\'' + jsonData[i].id + '\')" icon="md-caret-right"></ons-button>' + '</div>' + '</ons-list-item>' +


          '</ons-list>'
        )
      );
    }
  }

})

 // SINGLE PAGE
 function pushOverView(item){    

   document.querySelector('#myNavigator').pushPage('single-pokemon', {data: {item: item}}); 

} 

document.addEventListener('init', function(event){
    var page = event.target;

    if(page.id === 'single-pokemon-page'){
                        
        var slug = page.data.item;
        getSinglePokemon(slug);
        console.log(slug);
    }      
});

function getSinglePokemon(slug) {
 var spinnerModal = document.querySelector('#spinner-modal');
  spinnerModal.show();

  const promise = [];
  for (let i = 1; i <= 151; i++) {
    const newUrl = `https://pokeapi.co/api/v2/pokemon/${i}`;
    promise.push(fetch(newUrl).then(res => res.json()));
  }
  Promise.all(promise).then(results => {
      const singlePokemons = results.map(data => ({
        name: data.name,
        id: data.id,
        image: data.sprites["front_default"],
        type: data.types.map(type => type.type.name).join(", "),
        ability: data.abilities.map(ability => ability.ability.name).join(','),
        moves: data.moves.map(move => move.move.name).slice(0, 10).join(', ')
      }));
      description(singlePokemons);
    })
    .catch((reason) => {
      if (reason === -999) {
        console.error("Had previously handled error");
      } else {
        console.error(`Trouble with promiseGetWord(): ${reason}`);
      }
    })
    .finally((info) => spinnerModal.hide());
  }

  function description(jsonData) {
    var moreItemList = document.getElementById('description'); // this is no longer null since this is no longer part of template.
    // for (let i = 0; i < jsonData.length; i++) {

      moreItemList.appendChild(
        ons.createElement(
          '<div>' +  
                jsonData.name +
                '<div class="description">' + jsonData.name + '</div>' +
                '<ons-button>' +'<a href="' + jsonData.name + '">View Full Image</a>' + '</ons-button>' +
           '</div>'
        )
      );
    }
  // }

</script>
</body>

</html>